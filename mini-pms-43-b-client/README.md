### 43-b. 애플리케이션 서버 아키텍처로 전환하기 : 세션 다루기


`mini-pms-35-client` 프로젝트와 같다.


## 훈련 목표
-

## 훈련 내용
-

## 실습

### 1단계 - 각 클라이언트 마다 별도의 세션으로 다뤄야 하는 이유를 이해한다.

다음 순서에 따라 테스트 한다.

- 한 개의 클라이언트로 접속한다.
  - `aaa@test.com` 사용자로 로그인한다.
- 또 한 개의 클라이언트로 접속한다.
  - `명령> /whoami` 명령을 사용해 로그인 사용자 정보를 출력한다.
  - 이 클라이언트는 로그인 하지 않았는데 사용자 정보를 출력한다.
- 이유?
  - 로그인 정보를 모든 클라이언트가 공유하는 context 맵에 보관하기 때문이다.
- 해결책?
  - 클라이언트 전용 보관소를 사용하여 각 클라이언트 전용 정보를 다룬다.

### 2단계 - 클라이언트와 서버 간의 프로토콜 변경한다.

- 클라이언트가 보내는 요청 형식

```
클라이언트 세션 아이디 CRLF
요청 명령 CRLF

예)
SessionID=1299
/board/list
```

- 서버가 보내는 응답 형식

```
클라이언트 세션 아이디 CRLF
응답 데이터 CRLF
...
CRLF
예)
SessionID=1277
[게시물 목록]
...
...

```

### 3단계 - 서버에 요청할 때 마다 클라이언트의 세션 아이디를 보낸다.

- com.eomcs.pms.ClientApp 변경
  - `request()` 메서드 변경

### 4단계 - 서버로부터 응답을 받을 때 마다 세션 아이디를 보관한다.

- com.eomcs.pms.ClientApp 변경
  - `receiveResponse()` 메서드 변경

## 실습 결과

- src/main/java/com/eomcs/pms/ClientApp.java 변경
